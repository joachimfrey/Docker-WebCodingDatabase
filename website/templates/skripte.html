{% extends "navbar.html" %}

{% block content %}

<nav>
    <div>
        <div id="navbar_sub">
            <a id="navbaritem_sub" href="{{request.path}}" style="font-size: 20px; border-right: 2px black solid;">&#x27F3</a>
            {% for item in skripte_system %}<a id="navbaritem_sub" href="{{request.path}}?urlsystem={{item}}">{{item}}</a>{% endfor %}
        </div>
    </div>
</nav>

{% for row in skripte %}
    {% for row2 in row %}
        <div id="skript_box" style=" padding: 20px">
            <div style="display: flex; justify-content: space-between;">
                <div>
                    <a id="skript_titel">{{row2.0.titel}}</a>
                </div>
                    <button onclick="location.href='skripte?edit={{row2.0.id}}'" id="skript_submit">&#x270E</button>
            </div>
            {% for row3 in row2 %}
                <div style="display: flex">
                    {% if row3.link %}
                        <a id="skript_website" href="{{row3.link}}" target="_blank">&#x1F310;&#xfe0e;</a>
                    {% endif %}
                    <div onclick="copyToClipboard(this)"  id="skript_{{row3.text_id}}">{{row3.text}}</div>
                </div>
            {% endfor %}
        </div>
    {% endfor %}
{% endfor %}

{% if edit_entry %}
<div id="skript_box">
    <div style="margin: 10px; gap: 20px; display: flex; flex-direction: column;">
        <form method="POST" action="skripte?edit={{edit_entry.0.id}}">
            {% csrf_token %}
            <input type="hidden" name="post_id" value="edit">
                <div style="display: flex; flex-direction: column; gap: 10px; padding-bottom: 30px">
                    <div style="display: flex; flex-direction: row; justify-content: space-between">
                        <input id="skript_input" type="text" name="titel_new" value="{{edit_entry.0.titel}}" placeholder="Titel" autocomplete="off" style="padding: 5px; font-size: 25px;">
                        <input id="skript_input" type="submit" value="&#x1F4BE" style="width:30px; height: 30px;">
                    </div>
                    <div>
                        <input list="datalist_gruppe" name="system_new" id="skript_input" value="{% if edit_entry %}{{edit_entry.0.system}}{% elif path_filter %}{{path_filter}}{% else %}Allgemein{% endif %}">
                        <datalist id="datalist_gruppe" class="tabelle_fuÃŸzelle">
                            {% for item in skripte_system %}<option value="{{item}}">{{item}}</option>{% endfor %}
                        </datalist>
                    </div>
                </div>
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    {% for row in edit_entry %}
                        <div style="display: flex; flex-direction: column; gap: 5px">
                            <input type="hidden" name="id" value="{{row.id}}">
                            <div>
                            <select name="text_id" id="skript_input">
                                <option value="Text" {% if row.text_id == "Text" %}selected{% endif %}>Text</option>
                                <option value="Code" {% if row.text_id == "Code" %}selected{% endif %}>Code</option>
                            </select>
                                <input id="skript_input" type="text" name="link" placeholder="Link" value="{{row.link}}" autocomplete="off" style="width: 35%">
                            </div>
                            <textarea id="skript_input_text" name="text" autocomplete="off">{{row.text}}</textarea>
                        </div>
                    {% endfor %}
                </div>
        </form>
        <form method="POST" action="skripte?edit={{edit_entry.0.id}}">
            {% csrf_token %}
            <input type="hidden" name="post_id" value="create_entry">
            <input type="hidden" name="system" value="{{edit_entry.0.system}}">
            <input type="hidden" name="titel" value="{{edit_entry.0.titel}}">
        <div><input id="skript_input" type="submit" value="+" style="width:100%; height: 30px;"></div>
        </form>
    </div>
</div>
{% else %}
<div id="skript_box">
    <form method="POST" action="skripte?edit={{edit_entry.0.id}}">
        {% csrf_token %}
        <input type="hidden" name="post_id" value="create">
        <input type="hidden" name="system" value="{{path_filter}}">
        <input id="skript_button" type="submit" value="+" style="width:100%; height: 50px;font-size: 40px; border: none;">
    </form>
</div>
{% endif %}

<script>
function copyToClipboard(cell) {
    cell.classList.add('highlight');
      setTimeout(() => {
        cell.classList.remove('highlight');
      },    200);
    const textToCopy = cell.innerText;
    const tempTextarea = document.createElement('textarea');
    tempTextarea.value = textToCopy;
    document.body.appendChild(tempTextarea);
    tempTextarea.select();
    document.execCommand('copy');
    document.body.removeChild(tempTextarea);

    cell.classList.add('highlight');
}
</script>

{% endblock %}